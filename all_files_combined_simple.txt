

==== routes/api/authRoutes.js ====

// routes/api/authRoutes.js

const express = require('express');
const router = express.Router();
const authController = require('../../controllers/authController');
const { validateLogin, validateGuestLogin, validateFacebookLogin, validateLineLogin } = require('../../middlewares/validationMiddleware');
const { JWT_SECRET } = require('../../config'); // Corrected path

const jwt = require('jsonwebtoken');

// Import the logger
const logger = require('../../utils/logger');


router.post('/verify-token', (req, res) => {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];

    if (!token) {
        return res.status(401).json({ valid: false, message: 'No token provided.' });
    }

    jwt.verify(token, JWT_SECRET, (err, decoded) => {
        if (err) {
            return res.status(401).json({ valid: false, message: 'Invalid token.' });
        }

        // Optionally, you can include additional checks here

        return res.json({ valid: true });
    });
});


module.exports = router;


/**
 * @route POST /api/auth/login/google
 * @desc Authenticate user with Google and provide JWT
 */
router.post('/login/google', validateLogin, (req, res, next) => {
    logger.info('Received POST /api/auth/login/google request');
    next();
}, authController.loginWithGoogle);

/**
 * @route POST /api/auth/login/facebook
 * @desc Authenticate user with Facebook and provide JWT
 */
router.post('/login/facebook', validateFacebookLogin, (req, res, next) => {
    logger.info('Received POST /api/auth/login/facebook request');
    next();
}, authController.loginWithFacebook);

/**
 * @route POST /api/auth/login/line
 * @desc Authenticate user with LINE and provide JWT
 */
router.post('/login/line', validateLineLogin, (req, res, next) => {
    logger.info('Received POST /api/auth/login/line request');
    next();
}, authController.loginWithLine);

/**
 * @route POST /api/auth/login/guest
 * @desc Authenticate guest user and provide JWT
 */
router.post('/login/guest', validateGuestLogin, authController.loginAsGuest);

/**
 * @route POST /api/auth/complete-facebook-login
 * @desc Complete Facebook login by accepting additional info
 */
router.post('/complete-facebook-login', validateGuestLogin, (req, res, next) => {
    logger.info('Received POST /api/auth/complete-facebook-login request');
    authController.completeFacebookLogin(req, res, next);
});

// Add this route to handle LINE callback
router.get('/line/callback', authController.lineCallback);

module.exports = router;




==== routes/api/bookingRoutes.js ====

// routes/api/bookingRoutes.js

const express = require('express');
const router = express.Router();
const bookingController = require('../../controllers/bookingController');
const authMiddleware = require('../../middlewares/authMiddleware');

/**
 * @route GET /api/bookings/available-slots
 * @desc Get available booking slots for a specific date
 */
router.get('/available-slots', authMiddleware, bookingController.getAvailableSlots);

/**
 * @route POST /api/bookings/book-slot
 * @desc Book a slot
 */
router.post('/book-slot', authMiddleware, bookingController.bookSlot);

// Get bookings for the authenticated user
router.get('/my-bookings', authMiddleware, bookingController.getUserBookings);

module.exports = router;




==== routes/api/customerRoutes.js ====

// routes/api/customerRoutes.js

const express = require('express');
const router = express.Router();
const customerController = require('../../controllers/customerController');
const authMiddleware = require('../../middlewares/authMiddleware');

/**
 * @route GET /api/customers
 * @desc Get customer data by userId
 */
router.get('/', authMiddleware, async (req, res) => {
    const userId = req.query.userId;

    if (!userId) {
        return res.status(400).json({ success: false, message: 'userId parameter is required.' });
    }

    try {
        const customerData = await customerController.getCustomerDataById(userId);
        return res.status(200).json({ success: true, customerData });
    } catch (error) {
        return res.status(500).json({ success: false, message: 'Internal Server Error.' });
    }
});

module.exports = router;




==== routes/index.js ====

// routes/index.js

const express = require('express');
const router = express.Router();

const apiRouter = require('./api'); // routes/api/index.js

// Mount the API router at the root of this router
router.use('/', apiRouter);

module.exports = router;


